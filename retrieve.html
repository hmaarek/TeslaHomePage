<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retrieve Videos</title>
</head>
<body>
  <h1>Saved Videos</h1>
  <nav>
    <a href="save.html">Save Videos</a> | <a href="index.html">Go to Main Page</a>
  </nav>
  <ul id="videoList"></ul>
  <script>
    //original version of fetch function-----------------------------------------
    // fetch('/.netlify/functions/get-submissions')
    //   .then(response => response.json())
    //   .then(data => {
    //     const videoList = document.getElementById('videoList');
    //     data.forEach(submission => {
    //       videoList.innerHTML += `<li><a href='index.html?v=${submission.data.videoUrl}'>${submission.data.videoUrl}</a></li>`;
    //     });
    //   })
    //   .catch(err => console.error('Error fetching submissions:', err));
    //--------------------------------------------------------------------------

    //debug version of fetch by GPT


    //without video details:
  //   const apiKey = 'AIzaSyAXgS64rJ7C4vc3HhxP-YKy5aRCoNN_iwY'

    fetch('/.netlify/functions/get-submissions')
      .then(response => {
        if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
  .then(data => {
    //console.log('Response Data:', data); // Log the raw response
    const videoList = document.getElementById('videoList');
    if (Array.isArray(data)) {
      data.forEach(submission => {
        videoList.innerHTML += `<li><a href="index.html?v=${submission.data.videoUrl}">${submission.data.videoUrl}</a></li>`;
      });
    } else {
      videoList.innerHTML = '<li>No submissions found or invalid data format.</li>';
    }
  })
  .catch(err => console.error('Error fetching submissions:', err));


  //with Video Details
//   const apiKey = 'YOUR_YOUTUBE_API_KEY'; // Replace with your API key

// fetch('/.netlify/functions/get-submissions')
//   .then(response => response.json())
//   .then(data => {
//     const videoList = document.getElementById('videoList');

//     // Iterate through submissions and fetch video titles
//     data.forEach(submission => {
//       const videoUrl = submission.data.videoUrl;
//       const url = new URL(videoUrl);
//       const videoId = url.searchParams.get('v'); // Extract video ID from URL

//       if (videoId) {
//         // Fetch video details from YouTube Data API
//         fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`)
//           .then(res => res.json())
//           .then(videoData => {
//             const title = videoData.items[0]?.snippet?.title || 'Unknown Title';
//             videoList.innerHTML += `<li><a href="index.html?video=${encodeURIComponent(videoUrl)}">${title}</a></li>`;
//           })
//           .catch(err => {
//             console.error('Error fetching video details:', err);
//             videoList.innerHTML += `<li><a href="index.html?video=${encodeURIComponent(videoUrl)}">Unknown Title</a></li>`;
//           });
//       } else {
//         videoList.innerHTML += `<li>Invalid YouTube URL</li>`;
//       }
//     });
//   })
//   .catch(err => console.error('Error fetching submissions:', err));
  // </script>
</body>
</html>
